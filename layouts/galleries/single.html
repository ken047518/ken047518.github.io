{{ define "main" }}

<link rel="stylesheet" href="/css/photoswipe.css">

<article class="container mx-auto px-4 py-12">
  {{- /* Header */ -}}
  <header class="text-center mb-12">
    <h1 class="font-heading text-4xl md:text-5xl font-bold mb-4">
      {{ .Title }}
    </h1>

    <div class="flex flex-wrap justify-center gap-4 text-gray-600 dark:text-gray-400">
      {{- if .Params.location -}}
      <span>
        <i class="fas fa-map-marker-alt mr-1"></i>{{ .Params.location }}
      </span>
      {{- end -}}

      <span>
        <i class="fas fa-calendar mr-1"></i>
        <time datetime="{{ .Date.Format "2006-01-02" }}">
          {{ .Date.Format "January 2, 2006" }}
        </time>
      </span>
    </div>
  </header>

  {{- /* Gallery Grid */ -}}
  <div class="masonry sm:masonry-sm md:masonry-md pswp-gallery" id="gallery">
  {{- range $.Resources.ByType "image" -}}
    {{- $image := . -}}
    {{- if $image -}}
      {{- $thumb := $image.Resize "480x" -}}
      {{- $thumb2x := $image.Resize "960x" -}}
      {{- $full := $image.Resize "1920x" -}}
  <a href="{{ $full.Permalink }}"
     data-pswp-width="{{ $full.Width }}"
     data-pswp-height="{{ $full.Height }}"
     target="_blank"
     class="block rounded-lg group break-inside mb-4">
    <img
      src="{{ $thumb.Permalink }}"
      srcset="{{ $thumb.Permalink }} 1x, {{ $thumb2x.Permalink }} 2x"
      alt="{{ $.Title }}"
      loading="lazy"
      class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
    >
  </a>
    {{- end -}}
  {{- end -}}
  </div>

  {{- /* Content */ -}}
  {{- with .Content -}}
  <div class="prose prose-lg dark:prose-invert max-w-3xl mx-auto">
    {{ . }}
  </div>
  {{- end -}}

  {{- /* Navigation */ -}}
  <nav class="mt-12 pt-8 border-t border-gray-300 dark:border-gray-700 flex justify-between max-w-3xl mx-auto">
    {{- with .PrevInSection -}}
    <a href="{{ .Permalink }}" class="text-primary hover:underline">
      <i class="fas fa-arrow-left mr-2"></i>{{ .Title }}
    </a>
    {{- else -}}
    <span></span>
    {{- end -}}

    {{- with .NextInSection -}}
    <a href="{{ .Permalink }}" class="text-primary hover:underline">
      {{ .Title }}<i class="fas fa-arrow-right ml-2"></i>
    </a>
    {{- end -}}
  </nav>
</article>

<script type="module">
import PhotoSwipeLightbox from '/js/photoswipe-lightbox.esm.js';
const lightbox = new PhotoSwipeLightbox({
  gallery: '#gallery',
  children: 'a',
  pswpModule: () => import('/js/photoswipe.esm.js')
});
lightbox.init();
</script>

{{ end }}
